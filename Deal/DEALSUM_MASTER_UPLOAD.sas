%MACRO DEALMERGEINTO(INSTANCE);
PROC SQL;
	CONNECT TO ORACLE (USER=&USER. PASSWORD=&PASSWORD. PATH="BIOR");
	EXECUTE (MERGE INTO BIOR.O_DEAL_SUMMARY_ALL BIOR
    USING SKYNET.DEALSUM_DATAMART_&INSTANCE. UPSERT
        ON (BIOR.INSTANCE=UPSERT.INSTANCE 
			AND BIOR.DEALNBR=UPSERT.DEALNBR 
			AND BIOR.TITLE_DEALNBR=UPSERT.TITLE_DEALNBR)
        WHEN MATCHED THEN UPDATE
           SET 
                BIOR.PRODUCT = UPSERT.PRODUCT,
				BIOR.POS = UPSERT.POS,
				BIOR.CHANNELCD = UPSERT.CHANNELCD,
				BIOR.BRANDCD = UPSERT.BRANDCD,
				BIOR.BANKMODEL = UPSERT.BANKMODEL,
				BIOR.COUNTRYCD = UPSERT.COUNTRYCD,
				BIOR.STATE = UPSERT.STATE,
				BIOR.CITY = UPSERT.CITY,
				BIOR.ZIP = UPSERT.ZIP,
				BIOR.ZONENBR = UPSERT.ZONENBR,
				BIOR.ZONENAME = UPSERT.ZONENAME,
				BIOR.REGIONNBR = UPSERT.REGIONNBR,
				BIOR.REGIONRDO = UPSERT.REGIONRDO,
				BIOR.DIVISIONNBR = UPSERT.DIVISIONNBR,
				BIOR.DIVISIONDDO = UPSERT.DIVISIONDDO,
				BIOR.BUSINESS_UNIT = UPSERT.BUSINESS_UNIT,
				BIOR.LOCNBR = UPSERT.LOCNBR,
				BIOR.LOC_OPEN_DT = UPSERT.LOC_OPEN_DT,
				BIOR.LOC_CLOSE_DT = UPSERT.LOC_CLOSE_DT,
				BIOR.DEAL_DT = UPSERT.DEAL_DT,
				BIOR.DEAL_DTTM = UPSERT.DEAL_DTTM,
				BIOR.LAST_REPORT_DT = UPSERT.LAST_REPORT_DT,
				BIOR.CUSTNBR = UPSERT.CUSTNBR,
				BIOR.SSN = UPSERT.SSN,
				BIOR.OMNINBR = UPSERT.OMNINBR,
				BIOR.ADVAMT = UPSERT.ADVAMT,
				BIOR.FEEAMT = UPSERT.FEEAMT,
				BIOR.CUSTOMARYFEE = UPSERT.CUSTOMARYFEE,
				BIOR.NSFFEEAMT = UPSERT.NSFFEEAMT,
				BIOR.LATEFEEAMT = UPSERT.LATEFEEAMT,
				BIOR.OTHERFEEAMT = UPSERT.OTHERFEEAMT,
				BIOR.WAIVEDFEEAMT = UPSERT.WAIVEDFEEAMT,
				BIOR.REBATEAMT = UPSERT.REBATEAMT,
				BIOR.COUPONAMT = UPSERT.COUPONAMT,
				BIOR.TOTALPAID = UPSERT.TOTALPAID,
				BIOR.TOTALOWED = UPSERT.TOTALOWED,
				BIOR.CONSECUTIVEDEALFLG = UPSERT.CONSECUTIVEDEALFLG,
				BIOR.CASHAGNCNT = UPSERT.CASHAGNCNT,
				BIOR.DUEDT = UPSERT.DUEDT,
				BIOR.DEALENDDT = UPSERT.DEALENDDT,
				BIOR.WRITEOFFDT = UPSERT.WRITEOFFDT,
				BIOR.DEPOSITDT = UPSERT.DEPOSITDT,
				BIOR.DEFAULTDT = UPSERT.DEFAULTDT,
				BIOR.CUST_STATUS = ' ',
				BIOR.CHECKSTATUSCD = UPSERT.CHECKSTATUSCD,
				BIOR.DEALSTATUSCD = UPSERT.DEALSTATUSCD,
				BIOR.ACHSTATUSCD = UPSERT.ACHSTATUSCD,
				BIOR.RETURNREASONCD = UPSERT.RETURNREASONCD,
				BIOR.COLLATERAL_TYPE = UPSERT.COLLATERAL_TYPE,
				BIOR.CUSTCHECKNBR = UPSERT.CUSTCHECKNBR,
				BIOR.ETLDT = UPSERT.ETLDT,
				BIOR.PREVDEALNBR = UPSERT.PREVDEALNBR,
				BIOR.PRODUCTCD = UPSERT.PRODUCTCD,
				BIOR.INTERESTFEE = UPSERT.INTERESTFEE,
				BIOR.ACHAUTHFLG = UPSERT.ACHAUTHFLG,
				BIOR.UPDATEDT = UPSERT.UPDATEDT,
				BIOR.OUTSTANDING_DRAW_AMT = UPSERT.OUTSTANDING_DRAW_AMT,
				BIOR.UNDER_COLLATERALIZED = UPSERT.UNDER_COLLATERALIZED
         WHEN NOT MATCHED
            THEN INSERT
                 (
					PRODUCT,
					POS,
					INSTANCE,
					CHANNELCD,
					BRANDCD,
					BANKMODEL,
					COUNTRYCD,
					STATE,
					CITY,
					ZIP,
					ZONENBR,
					ZONENAME,
					REGIONNBR,
					REGIONRDO,
					DIVISIONNBR,
					DIVISIONDDO,
					BUSINESS_UNIT,
					LOCNBR,
					LOC_OPEN_DT,
					LOC_CLOSE_DT,
					DEAL_DT,
					DEAL_DTTM,
					LAST_REPORT_DT,
					DEALNBR,
					TITLE_DEALNBR,
					CUSTNBR,
					SSN,
					OMNINBR,
					ADVAMT,
					FEEAMT,
					CUSTOMARYFEE,
					NSFFEEAMT,
					LATEFEEAMT,
					OTHERFEEAMT,
					WAIVEDFEEAMT,
					REBATEAMT,
					COUPONAMT,
					TOTALPAID,
					TOTALOWED,
					CONSECUTIVEDEALFLG,
					CASHAGNCNT,
					DUEDT,
					DEALENDDT,
					WRITEOFFDT,
					DEPOSITDT,
					DEFAULTDT,
					CUST_STATUS,
					CHECKSTATUSCD,
					DEALSTATUSCD,
					ACHSTATUSCD,
					RETURNREASONCD,
					COLLATERAL_TYPE,
					CUSTCHECKNBR,
					ETLDT,
					PREVDEALNBR,
					PRODUCTCD,
					INTERESTFEE,
					ACHAUTHFLG,
					UPDATEDT,
					OUTSTANDING_DRAW_AMT,
					UNDER_COLLATERALIZED	
				)
            VALUES 
                 (
					UPSERT.PRODUCT,
					UPSERT.POS,
					UPSERT.INSTANCE,
					UPSERT.CHANNELCD,
					UPSERT.BRANDCD,
					UPSERT.BANKMODEL,
					UPSERT.COUNTRYCD,
					UPSERT.STATE,
					UPSERT.CITY,
					UPSERT.ZIP,
					UPSERT.ZONENBR,
					UPSERT.ZONENAME,
					UPSERT.REGIONNBR,
					UPSERT.REGIONRDO,
					UPSERT.DIVISIONNBR,
					UPSERT.DIVISIONDDO,
					UPSERT.BUSINESS_UNIT,
					UPSERT.LOCNBR,
					UPSERT.LOC_OPEN_DT,
					UPSERT.LOC_CLOSE_DT,
					UPSERT.DEAL_DT,
					UPSERT.DEAL_DTTM,
					UPSERT.LAST_REPORT_DT,
					UPSERT.DEALNBR,
					UPSERT.TITLE_DEALNBR,
					UPSERT.CUSTNBR,
					UPSERT.SSN,
					UPSERT.OMNINBR,
					UPSERT.ADVAMT,
					UPSERT.FEEAMT,
					UPSERT.CUSTOMARYFEE,
					UPSERT.NSFFEEAMT,
					UPSERT.LATEFEEAMT,
					UPSERT.OTHERFEEAMT,
					UPSERT.WAIVEDFEEAMT,
					UPSERT.REBATEAMT,
					UPSERT.COUPONAMT,
					UPSERT.TOTALPAID,
					UPSERT.TOTALOWED,
					UPSERT.CONSECUTIVEDEALFLG,
					UPSERT.CASHAGNCNT,
					UPSERT.DUEDT,
					UPSERT.DEALENDDT,
					UPSERT.WRITEOFFDT,
					UPSERT.DEPOSITDT,
					UPSERT.DEFAULTDT,
					' ',
					UPSERT.CHECKSTATUSCD,
					UPSERT.DEALSTATUSCD,
					UPSERT.ACHSTATUSCD,
					UPSERT.RETURNREASONCD,
					UPSERT.COLLATERAL_TYPE,
					UPSERT.CUSTCHECKNBR,
					UPSERT.ETLDT,
					UPSERT.PREVDEALNBR,
					UPSERT.PRODUCTCD,
					UPSERT.INTERESTFEE,
					UPSERT.ACHAUTHFLG,
					UPSERT.UPDATEDT,
					UPSERT.OUTSTANDING_DRAW_AMT,
					UPSERT.UNDER_COLLATERALIZED	
				)
	) BY ORACLE;
	DISCONNECT FROM ORACLE;
QUIT;
%MEND;