%INCLUDE "\\CSSSASAPP\CADA\SAS SOURCE CODE\PRODUCTION\SERVICE ACCOUNTS\SVC_SASUSER.SAS";
%INCLUDE "E:\SHARED\CADA\SAS SOURCE CODE\DEVELOPMENT\JHUBBARD\SKYNET REDESIGN\DATAMART REDESIGN\DAILY\DAILY_ERROR_INPUTS.SAS";

/*UPDATE STATUS TABLE*/
PROC SQL;
CONNECT TO ORACLE (USER=&USER. PW=&PASSWORD. PATH='BIOR');
	EXECUTE(UPDATE BIOR.DATAMART_STATUS
			SET FUSE_STATUS = 'UPLOADING'
			   ,FUSE_RUN_DATE = CURRENT_DATE
			WHERE SOURCE = 'BIOR.O_DAILY_SUMMARY_ALL'
			)
	 BY ORACLE;
	 DISCONNECT FROM ORACLE;
%RUNQUIT(&job,&sub28);

/*  UPDATE BIOR PRODUCTION TABLE WITH NEW DATA  */
PROC SQL;
	CONNECT TO ORACLE (USER=&USER. PASSWORD=&PASSWORD. PATH="BIOR") ;
	EXECUTE (MERGE INTO BIOR.FUSE_DAILYSUMMARY BIOR
    USING SKYNET.DAILYSUM_DATAMART_FUSE UPSERT
        ON (BIOR.INSTANCE=UPSERT.INSTANCE 
			AND BIOR.LOCNBR=UPSERT.LOCNBR
			AND BIOR.BUSINESSDT = UPSERT.BUSINESSDT
			AND BIOR.PRODUCT = UPSERT.PRODUCT)
        WHEN MATCHED THEN UPDATE
           SET 
/*			BIOR.PRODUCT	=	UPSERT.PRODUCT,*/
			BIOR.PRODUCT_DESC	=	UPSERT.PRODUCT_DESC,
			BIOR.POS	=	UPSERT.POS,
/*			BIOR.INSTANCE	=	UPSERT.INSTANCE,*/
			BIOR.BRANDCD	=	UPSERT.BRANDCD,
			BIOR.BANKMODEL	=	UPSERT.BANKMODEL,
			BIOR.COUNTRYCD	=	UPSERT.COUNTRYCD,
			BIOR.STATE	=	UPSERT.STATE,
			BIOR.CITY	=	UPSERT.CITY,
			BIOR.ZIP	=	UPSERT.ZIP,
			BIOR.BUSINESS_UNIT	=	UPSERT.BUSINESS_UNIT,
			BIOR.ZONENBR	=	UPSERT.ZONENBR,
			BIOR.ZONENAME	=	UPSERT.ZONENAME,
			BIOR.REGIONNBR	=	UPSERT.REGIONNBR,
			BIOR.REGIONRDO	=	UPSERT.REGIONRDO,
			BIOR.DIVISIONNBR	=	UPSERT.DIVISIONNBR,
			BIOR.DIVISIONDDO	=	UPSERT.DIVISIONDDO,
/*			BIOR.LOCNBR	=	UPSERT.LOCNBR,*/
			BIOR.LOCATION_NAME	=	UPSERT.LOCATION_NAME,
			BIOR.LOC_OPEN_DT	=	UPSERT.LOC_OPEN_DT,
			BIOR.LOC_CLOSE_DT	=	UPSERT.LOC_CLOSE_DT,
/*			BIOR.BUSINESSDT	=	UPSERT.BUSINESSDT,*/
			BIOR.LAST_REPORT_DT	=	UPSERT.LAST_REPORT_DT,
			BIOR.LATITUDE	=	UPSERT.LATITUDE,
			BIOR.LONGITUDE	=	UPSERT.LONGITUDE,
			BIOR.HOLIDAYNAME	=	UPSERT.HOLIDAYNAME,
			BIOR.LASTTHURSDAY	=	UPSERT.LASTTHURSDAY,
			BIOR.THURSDAYWEEK	=	UPSERT.THURSDAYWEEK,
			BIOR.COMPCNT	=	UPSERT.COMPCNT,
			BIOR.COMPAMT	=	UPSERT.COMPAMT,
			BIOR.COMPCHANGECNT	=	UPSERT.COMPCHANGECNT,
			BIOR.COMPCHANGEAMT	=	UPSERT.COMPCHANGEAMT,
			BIOR.COMPLOANRECVAMT	=	UPSERT.COMPLOANRECVAMT,
			BIOR.COMPLOANPOTREVENUEAMT	=	UPSERT.COMPLOANPOTREVENUEAMT,
			BIOR.FIRSTTIMELOANSCNT	=	UPSERT.FIRSTTIMELOANSCNT,
			BIOR.FIRSTTIMELOANSAMT	=	UPSERT.FIRSTTIMELOANSAMT,
			BIOR.NEWLOANSCNT	=	UPSERT.NEWLOANSCNT,
			BIOR.NEWLOANSAMT	=	UPSERT.NEWLOANSAMT,
			BIOR.TOTDRAWSCNT	=	UPSERT.TOTDRAWSCNT,
			BIOR.TOTDRAWSAMT	=	UPSERT.TOTDRAWSAMT,
			BIOR.REFINANCECNT	=	UPSERT.REFINANCECNT,
			BIOR.EXTENSIONSCNT	=	UPSERT.EXTENSIONSCNT,
			BIOR.EXTENSIONSAMT	=	UPSERT.EXTENSIONSAMT,
			BIOR.AVERAGELOANAMT	=	UPSERT.AVERAGELOANAMT,
			BIOR.AVERAGEDRAWAMT	=	UPSERT.AVERAGEDRAWAMT,
			BIOR.DELCNT	=	UPSERT.DELCNT,
			BIOR.DELAMT	=	UPSERT.DELAMT,
			BIOR.DELCHANGECNT	=	UPSERT.DELCHANGECNT,
			BIOR.DELCHANGEAMT	=	UPSERT.DELCHANGEAMT,
			BIOR.DELLOANRECVAMT	=	UPSERT.DELLOANRECVAMT,
			BIOR.DELLOANPOTREVENUEAMT	=	UPSERT.DELLOANPOTREVENUEAMT,
			BIOR.DEFCNT	=	UPSERT.DEFCNT,
			BIOR.DEFAMT	=	UPSERT.DEFAMT,
			BIOR.DEFCHANGECNT	=	UPSERT.DEFCHANGECNT,
			BIOR.DEFCHANGEAMT	=	UPSERT.DEFCHANGEAMT,
			BIOR.DEFLOANRECVAMT	=	UPSERT.DEFLOANRECVAMT,
			BIOR.DEFLOANPOTREVENUEAMT	=	UPSERT.DEFLOANPOTREVENUEAMT,
			BIOR.NEWDEFCNT	=	UPSERT.NEWDEFCNT,
			BIOR.NEWDEFAMT	=	UPSERT.NEWDEFAMT,
			BIOR.WOCOCNT	=	UPSERT.WOCOCNT,
			BIOR.WOCOAMT	=	UPSERT.WOCOAMT,
			BIOR.WOCOCHANGECNT	=	UPSERT.WOCOCHANGECNT,
			BIOR.WOCOCHANGEAMT	=	UPSERT.WOCOCHANGEAMT,
			BIOR.WOCOLOANRECVAMT	=	UPSERT.WOCOLOANRECVAMT,
			BIOR.WOCOLOANPOTREVENUEAMT	=	UPSERT.WOCOLOANPOTREVENUEAMT,
			BIOR.REPAYMENTPLANSCNT	=	UPSERT.REPAYMENTPLANSCNT,
			BIOR.TOTLINECNT	=	UPSERT.TOTLINECNT,
			BIOR.TOTAVAILABLECREDITAMT	=	UPSERT.TOTAVAILABLECREDITAMT,
			BIOR.CURRENTCNT	=	UPSERT.CURRENTCNT,
			BIOR.CURRENTAMT	=	UPSERT.CURRENTAMT,
			BIOR.DELPAYCNT	=	UPSERT.DELPAYCNT,
			BIOR.DELPAYAMT	=	UPSERT.DELPAYAMT,
			BIOR.PENDINGCLOSEDCNT	=	UPSERT.PENDINGCLOSEDCNT,
			BIOR.PENDINGCLOSEDAMT	=	UPSERT.PENDINGCLOSEDAMT,
			BIOR.DEFPAYCNT	=	UPSERT.DEFPAYCNT,
			BIOR.DEFPAYAMT	=	UPSERT.DEFPAYAMT,
			BIOR.WOCOPAYAMT	=	UPSERT.WOCOPAYAMT,
			BIOR.WOCOPAYCNT	=	UPSERT.WOCOPAYCNT,
			BIOR.GROSSREVENUEAMT	=	UPSERT.GROSSREVENUEAMT,
			BIOR.NETREVENUEAMT	=	UPSERT.NETREVENUEAMT,
			BIOR.WAIVEDFEESCNT	=	UPSERT.WAIVEDFEESCNT,
			BIOR.WAIVEDFEESAMT	=	UPSERT.WAIVEDFEESAMT,
			BIOR.COUPONSCNT	=	UPSERT.COUPONSCNT,
			BIOR.COUPONSAMT	=	UPSERT.COUPONSAMT,
			BIOR.REBATESCNT	=	UPSERT.REBATESCNT,
			BIOR.REBATESAMT	=	UPSERT.REBATESAMT,
			BIOR.SATISFIEDPAYMENTSCNT	=	UPSERT.SATISFIEDPAYMENTSCNT,
			BIOR.AVGDURATIONCNT	=	UPSERT.AVGDURATIONCNT,
			BIOR.FIRSTPRESENTMENTCNT	=	UPSERT.FIRSTPRESENTMENTCNT,
			BIOR.FIRSTPRESENTMENTAMT	=	UPSERT.FIRSTPRESENTMENTAMT,
			BIOR.SECONDPRESENTMENTCNT	=	UPSERT.SECONDPRESENTMENTCNT,
			BIOR.SECONDPRESENTMENTAMT	=	UPSERT.SECONDPRESENTMENTAMT,
			BIOR.THIRDPRESENTMENTCNT	=	UPSERT.THIRDPRESENTMENTCNT,
			BIOR.THIRDPRESENTMENTAMT	=	UPSERT.THIRDPRESENTMENTAMT,
			BIOR.VOLSURRABANDONSCNT	=	UPSERT.VOLSURRABANDONSCNT,
			BIOR.VOLSURRABANDONSAMT	=	UPSERT.VOLSURRABANDONSAMT,
			BIOR.REPOSSESSIONCNT	=	UPSERT.REPOSSESSIONCNT,
			BIOR.REPOSSESSIONAMT	=	UPSERT.REPOSSESSIONAMT,
			BIOR.WOCOEXPAMT	=	UPSERT.WOCOEXPAMT,
			BIOR.CURRENT_PWO_AMT	=	UPSERT.CURRENT_PWO_AMT,
			BIOR.NEXT_MONTH_PWO_AMT	=	UPSERT.NEXT_MONTH_PWO_AMT,
			BIOR.NEXT_2_MONTH_PWO_AMT	=	UPSERT.NEXT_2_MONTH_PWO_AMT,
			BIOR.BEGIN_PWO_AMT	=	UPSERT.BEGIN_PWO_AMT,
			BIOR.NEWCUSTCNTCOMPANY	=	UPSERT.NEWCUSTCNTCOMPANY,
			BIOR.REDEEM_CUSTOMER_CNT	=	UPSERT.REDEEM_CUSTOMER_CNT,
			BIOR.REACTIVE_CUSTOMER_CNT	=	UPSERT.REACTIVE_CUSTOMER_CNT,
			BIOR.ACTIVE_CUST_CNT	=	UPSERT.ACTIVE_CUST_CNT,
			BIOR.INACTIVE_CUST_CNT	=	UPSERT.INACTIVE_CUST_CNT,
			BIOR.CHANNELCD	=	UPSERT.CHANNELCD	
         WHEN NOT MATCHED
            THEN INSERT
                 (PRODUCT,
					PRODUCT_DESC,
					POS,
					INSTANCE,
					BRANDCD,
					BANKMODEL,
					COUNTRYCD,
					STATE,
					CITY,
					ZIP,
					BUSINESS_UNIT,
					ZONENBR,
					ZONENAME,
					REGIONNBR,
					REGIONRDO,
					DIVISIONNBR,
					DIVISIONDDO,
					LOCNBR,
					LOCATION_NAME,
					LOC_OPEN_DT,
					LOC_CLOSE_DT,
					BUSINESSDT,
					LAST_REPORT_DT,
					LATITUDE,
					LONGITUDE,
					HOLIDAYNAME,
					LASTTHURSDAY,
					THURSDAYWEEK,
					COMPCNT,
					COMPAMT,
					COMPCHANGECNT,
					COMPCHANGEAMT,
					COMPLOANRECVAMT,
					COMPLOANPOTREVENUEAMT,
					FIRSTTIMELOANSCNT,
					FIRSTTIMELOANSAMT,
					NEWLOANSCNT,
					NEWLOANSAMT,
					TOTDRAWSCNT,
					TOTDRAWSAMT,
					REFINANCECNT,
					EXTENSIONSCNT,
					EXTENSIONSAMT,
					AVERAGELOANAMT,
					AVERAGEDRAWAMT,
					DELCNT,
					DELAMT,
					DELCHANGECNT,
					DELCHANGEAMT,
					DELLOANRECVAMT,
					DELLOANPOTREVENUEAMT,
					DEFCNT,
					DEFAMT,
					DEFCHANGECNT,
					DEFCHANGEAMT,
					DEFLOANRECVAMT,
					DEFLOANPOTREVENUEAMT,
					NEWDEFCNT,
					NEWDEFAMT,
					WOCOCNT,
					WOCOAMT,
					WOCOCHANGECNT,
					WOCOCHANGEAMT,
					WOCOLOANRECVAMT,
					WOCOLOANPOTREVENUEAMT,
					REPAYMENTPLANSCNT,
					TOTLINECNT,
					TOTAVAILABLECREDITAMT,
					CURRENTCNT,
					CURRENTAMT,
					DELPAYCNT,
					DELPAYAMT,
					PENDINGCLOSEDCNT,
					PENDINGCLOSEDAMT,
					DEFPAYCNT,
					DEFPAYAMT,
					WOCOPAYAMT,
					WOCOPAYCNT,
					GROSSREVENUEAMT,
					NETREVENUEAMT,
					WAIVEDFEESCNT,
					WAIVEDFEESAMT,
					COUPONSCNT,
					COUPONSAMT,
					REBATESCNT,
					REBATESAMT,
					SATISFIEDPAYMENTSCNT,
					AVGDURATIONCNT,
					FIRSTPRESENTMENTCNT,
					FIRSTPRESENTMENTAMT,
					SECONDPRESENTMENTCNT,
					SECONDPRESENTMENTAMT,
					THIRDPRESENTMENTCNT,
					THIRDPRESENTMENTAMT,
					VOLSURRABANDONSCNT,
					VOLSURRABANDONSAMT,
					REPOSSESSIONCNT,
					REPOSSESSIONAMT,
					WOCOEXPAMT,
					CURRENT_PWO_AMT,
					NEXT_MONTH_PWO_AMT,
					NEXT_2_MONTH_PWO_AMT,
					BEGIN_PWO_AMT,
					NEWCUSTCNTCOMPANY,
					REDEEM_CUSTOMER_CNT,
					REACTIVE_CUSTOMER_CNT,
					ACTIVE_CUST_CNT,
					INACTIVE_CUST_CNT,
					CHANNELCD)
            VALUES 
                 (UPSERT.PRODUCT,
					UPSERT.PRODUCT_DESC,
					UPSERT.POS,
					UPSERT.INSTANCE,
					UPSERT.BRANDCD,
					UPSERT.BANKMODEL,
					UPSERT.COUNTRYCD,
					UPSERT.STATE,
					UPSERT.CITY,
					UPSERT.ZIP,
					UPSERT.BUSINESS_UNIT,
					UPSERT.ZONENBR,
					UPSERT.ZONENAME,
					UPSERT.REGIONNBR,
					UPSERT.REGIONRDO,
					UPSERT.DIVISIONNBR,
					UPSERT.DIVISIONDDO,
					UPSERT.LOCNBR,
					UPSERT.LOCATION_NAME,
					UPSERT.LOC_OPEN_DT,
					UPSERT.LOC_CLOSE_DT,
					UPSERT.BUSINESSDT,
					UPSERT.LAST_REPORT_DT,
					UPSERT.LATITUDE,
					UPSERT.LONGITUDE,
					UPSERT.HOLIDAYNAME,
					UPSERT.LASTTHURSDAY,
					UPSERT.THURSDAYWEEK,
					UPSERT.COMPCNT,
					UPSERT.COMPAMT,
					UPSERT.COMPCHANGECNT,
					UPSERT.COMPCHANGEAMT,
					UPSERT.COMPLOANRECVAMT,
					UPSERT.COMPLOANPOTREVENUEAMT,
					UPSERT.FIRSTTIMELOANSCNT,
					UPSERT.FIRSTTIMELOANSAMT,
					UPSERT.NEWLOANSCNT,
					UPSERT.NEWLOANSAMT,
					UPSERT.TOTDRAWSCNT,
					UPSERT.TOTDRAWSAMT,
					UPSERT.REFINANCECNT,
					UPSERT.EXTENSIONSCNT,
					UPSERT.EXTENSIONSAMT,
					UPSERT.AVERAGELOANAMT,
					UPSERT.AVERAGEDRAWAMT,
					UPSERT.DELCNT,
					UPSERT.DELAMT,
					UPSERT.DELCHANGECNT,
					UPSERT.DELCHANGEAMT,
					UPSERT.DELLOANRECVAMT,
					UPSERT.DELLOANPOTREVENUEAMT,
					UPSERT.DEFCNT,
					UPSERT.DEFAMT,
					UPSERT.DEFCHANGECNT,
					UPSERT.DEFCHANGEAMT,
					UPSERT.DEFLOANRECVAMT,
					UPSERT.DEFLOANPOTREVENUEAMT,
					UPSERT.NEWDEFCNT,
					UPSERT.NEWDEFAMT,
					UPSERT.WOCOCNT,
					UPSERT.WOCOAMT,
					UPSERT.WOCOCHANGECNT,
					UPSERT.WOCOCHANGEAMT,
					UPSERT.WOCOLOANRECVAMT,
					UPSERT.WOCOLOANPOTREVENUEAMT,
					UPSERT.REPAYMENTPLANSCNT,
					UPSERT.TOTLINECNT,
					UPSERT.TOTAVAILABLECREDITAMT,
					UPSERT.CURRENTCNT,
					UPSERT.CURRENTAMT,
					UPSERT.DELPAYCNT,
					UPSERT.DELPAYAMT,
					UPSERT.PENDINGCLOSEDCNT,
					UPSERT.PENDINGCLOSEDAMT,
					UPSERT.DEFPAYCNT,
					UPSERT.DEFPAYAMT,
					UPSERT.WOCOPAYAMT,
					UPSERT.WOCOPAYCNT,
					UPSERT.GROSSREVENUEAMT,
					UPSERT.NETREVENUEAMT,
					UPSERT.WAIVEDFEESCNT,
					UPSERT.WAIVEDFEESAMT,
					UPSERT.COUPONSCNT,
					UPSERT.COUPONSAMT,
					UPSERT.REBATESCNT,
					UPSERT.REBATESAMT,
					UPSERT.SATISFIEDPAYMENTSCNT,
					UPSERT.AVGDURATIONCNT,
					UPSERT.FIRSTPRESENTMENTCNT,
					UPSERT.FIRSTPRESENTMENTAMT,
					UPSERT.SECONDPRESENTMENTCNT,
					UPSERT.SECONDPRESENTMENTAMT,
					UPSERT.THIRDPRESENTMENTCNT,
					UPSERT.THIRDPRESENTMENTAMT,
					UPSERT.VOLSURRABANDONSCNT,
					UPSERT.VOLSURRABANDONSAMT,
					UPSERT.REPOSSESSIONCNT,
					UPSERT.REPOSSESSIONAMT,
					UPSERT.WOCOEXPAMT,
					UPSERT.CURRENT_PWO_AMT,
					UPSERT.NEXT_MONTH_PWO_AMT,
					UPSERT.NEXT_2_MONTH_PWO_AMT,
					UPSERT.BEGIN_PWO_AMT,
					UPSERT.NEWCUSTCNTCOMPANY,
					UPSERT.REDEEM_CUSTOMER_CNT,
					UPSERT.REACTIVE_CUSTOMER_CNT,
					UPSERT.ACTIVE_CUST_CNT,
					UPSERT.INACTIVE_CUST_CNT,
					UPSERT.CHANNELCD)
	) BY ORACLE;
	DISCONNECT FROM ORACLE;
QUIT;


/*UPDATE STATUS TABLE*/
PROC SQL;
CONNECT TO ORACLE (USER=&USER. PW=&PASSWORD. PATH='BIOR');
	EXECUTE(UPDATE BIOR.DATAMART_STATUS
			SET FUSE_STATUS = 'FINISHED'
			   ,FUSE_COMPLETION_DATE = CURRENT_DATE
			WHERE SOURCE = 'BIOR.O_DAILY_SUMMARY_ALL'
			)
	 BY ORACLE;
	 DISCONNECT FROM ORACLE;
%RUNQUIT(&job,&sub42);
